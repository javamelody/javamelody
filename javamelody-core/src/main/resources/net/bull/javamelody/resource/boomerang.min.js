/*
 * Copyright (c) 2011, Yahoo! Inc.  All rights reserved.
 * Copyright (c) 2012, Log-Normal, Inc.  All rights reserved.
 * Copyright (c) 2014, SOASTA, Inc. All rights reserved.
 * Copyrights licensed under the BSD License. See the accompanying LICENSE.txt file for terms.
 */
function BOOMR_check_doc_domain(a){var b;if(!a){if(window.parent===window||!document.getElementById("boomr-if-as"))return!0;a=document.domain}if(-1===a.indexOf("."))return!1;try{return b=window.parent.document,void 0!==b}catch(c){document.domain=a}try{return b=window.parent.document,void 0!==b}catch(c){a=a.replace(/^[\w\-]+\./,"")}return BOOMR_check_doc_domain(a)}BOOMR_start=(new Date).getTime(),BOOMR_check_doc_domain(),function(a){function g(a,b){var c=f(a,{detail:b});c&&BOOMR.setImmediate(function(){d.dispatchEvent?d.dispatchEvent(c):d.fireEvent&&d.fireEvent("onpropertychange",c)})}var b,c,d,e,f;a.parent!==a&&document.getElementById("boomr-if-as")&&"script"===document.getElementById("boomr-if-as").nodeName.toLowerCase()&&(a=a.parent,e=document.getElementById("boomr-if-as").src),d=a.document,void 0===a.BOOMR&&(a.BOOMR={}),BOOMR=a.BOOMR,BOOMR.version||(BOOMR.version="0.9",BOOMR.window=a,function(){try{void 0!==new a.CustomEvent("CustomEvent")&&(f=function(b,c){return new a.CustomEvent(b,c)})}catch(b){}try{!f&&d.createEvent&&d.createEvent("CustomEvent")&&(f=function(a,b){var c=d.createEvent("CustomEvent");return b=b||{cancelable:!1,bubbles:!1},c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c})}catch(b){}!f&&d.createEventObject&&(f=function(a,b){var c=d.createEventObject();return c.type=c.propertyName=a,c.detail=b.detail,c}),f||(f=function(){return void 0})}(),b={beacon_url:"",beacon_type:"AUTO",site_domain:a.location.hostname.replace(/.*?([^.]+\.[^.]+)\.?$/,"$1").toLowerCase(),user_ip:"",strip_query_string:!1,onloadfired:!1,handlers_attached:!1,events:{page_ready:[],page_unload:[],dom_loaded:[],visibility_changed:[],before_beacon:[],onbeacon:[],xhr_load:[],click:[],form_submit:[]},public_events:{before_beacon:"onBeforeBoomerangBeacon",onbeacon:"onBoomerangBeacon",onboomerangloaded:"onBoomerangLoaded"},vars:{},errors:{},disabled_plugins:{},onclick_handler:function(c){var d;c||(c=a.event),c.target?d=c.target:c.srcElement&&(d=c.srcElement),3===d.nodeType&&(d=d.parentNode),d&&"OBJECT"===d.nodeName.toUpperCase()&&"application/x-shockwave-flash"===d.type||b.fireEvent("click",d)},onsubmit_handler:function(c){var d;c||(c=a.event),c.target?d=c.target:c.srcElement&&(d=c.srcElement),3===d.nodeType&&(d=d.parentNode),b.fireEvent("form_submit",d)},fireEvent:function(a,b){var c,d,e;if(a=a.toLowerCase(),!this.events.hasOwnProperty(a))return!1;for(this.public_events.hasOwnProperty(a)&&g(this.public_events[a],b),e=this.events[a],c=0;c<e.length;c++)try{d=e[c],d.fn.call(d.scope,b,d.cb_data)}catch(f){BOOMR.addError(f,"fireEvent."+a)}return!0}},c={t_lstart:null,t_start:BOOMR_start,t_end:null,url:e,utils:{objectToString:function(a,b,c){var e,d=[];if(!a||"object"!=typeof a)return a;if(void 0===b&&(b="\n	"),c||(c=0),"[object Array]"===Object.prototype.toString.call(a)){for(e=0;e<a.length;e++)c>0&&null!==a[e]&&"object"==typeof a[e]?d.push(this.objectToString(a[e],b+("\n	"===b?"	":""),c-1)):d.push(encodeURIComponent(a[e]));b=","}else for(e in a)Object.prototype.hasOwnProperty.call(a,e)&&(c>0&&null!==a[e]&&"object"==typeof a[e]?d.push(encodeURIComponent(e)+"="+this.objectToString(a[e],b+("\n	"===b?"	":""),c-1)):d.push(encodeURIComponent(e)+"="+encodeURIComponent(a[e])));return d.join(b)},getCookie:function(a){if(!a)return null;a=" "+a+"=";var b,c;return c=" "+d.cookie+";",(b=c.indexOf(a))>=0?(b+=a.length,c=c.substring(b,c.indexOf(";",b))):null},setCookie:function(a,c,e){var f,g,h,i,j;if(!a||!b.site_domain)return BOOMR.debug("No cookie name or site domain: "+a+"/"+b.site_domain),!1;if(f=this.objectToString(c,"&"),g=a+"="+f,i=[g,"path=/","domain="+b.site_domain],e&&(j=new Date,j.setTime(j.getTime()+1e3*e),j=j.toGMTString(),i.push("expires="+j)),g.length<500){if(d.cookie=i.join("; "),h=this.getCookie(a),f===h)return!0;BOOMR.warn("Saved cookie value doesn't match what we tried to set:\n"+f+"\n"+h)}else BOOMR.warn("Cookie too long: "+g.length+" "+g);return!1},getSubCookies:function(a){var b,c,d,e,f=!1,g={};if(!a)return null;if("string"!=typeof a)return BOOMR.debug("TypeError: cookie is not a string: "+typeof a),null;for(b=a.split("&"),c=0,d=b.length;d>c;c++)e=b[c].split("="),e[0]&&(e.push(""),g[decodeURIComponent(e[0])]=decodeURIComponent(e[1]),f=!0);return f?g:null},removeCookie:function(a){return this.setCookie(a,{},-86400)},cleanupURL:function(a){return a?b.strip_query_string?a.replace(/\?.*/,"?qs-redacted"):a:""},hashQueryString:function(a,b){return a?(a.match(/^\/\//)&&(a=location.protocol+a),a.match(/^(https?|file):/)?(b&&(a=a.replace(/#.*/,"")),BOOMR.utils.MD5?a.replace(/\?([^#]*)/,function(a,b){return"?"+(b.length>10?BOOMR.utils.MD5(b):b)}):a):(BOOMR.error("Passed in URL is invalid: "+a),"")):a},pluginConfig:function(a,b,c,d){var e,f=0;if(!b||!b[c])return!1;for(e=0;e<d.length;e++)void 0!==b[c][d[e]]&&(a[d[e]]=b[c][d[e]],f++);return f>0},addListener:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)},removeListener:function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)},pushVars:function(a,b,c){var d,e,f=0;for(d in b)if(b.hasOwnProperty(d))if("[object Array]"===Object.prototype.toString.call(b[d]))for(e=0;e<b[d].length;++e)f+=BOOMR.utils.pushVars(a,b[d][e],d+"["+e+"]");else++f,a.push(encodeURIComponent(c?c+"["+d+"]":d)+"="+(void 0===b[d]||null===b[d]?"":encodeURIComponent(b[d])));return f},postData:function(a){var c=document.createElement("iframe"),d=document.createElement("form"),e=document.createElement("input");c.name="boomerang_post",c.style.display=d.style.display="none",d.method="POST",d.action=b.beacon_url,d.target=c.name,e.name="data",window.JSON?(d.enctype="text/plain",e.value=JSON.stringify(b.vars)):(d.enctype="application/x-www-form-urlencoded",e.value=a),document.body.appendChild(c),d.appendChild(e),document.body.appendChild(d),BOOMR.utils.addListener(c,"load",function(){document.body.removeChild(d),document.body.removeChild(c)}),d.submit()}},init:function(e){var f,g,h=["beacon_url","beacon_type","site_domain","user_ip","strip_query_string"];for(BOOMR_check_doc_domain(),e||(e={}),f=0;f<h.length;f++)void 0!==e[h[f]]&&(b[h[f]]=e[h[f]]);void 0!==e.log&&(this.log=e.log),this.log||(this.log=function(){});for(g in this.plugins)if(this.plugins.hasOwnProperty(g)){if(e[g]&&e[g].hasOwnProperty("enabled")&&e[g].enabled===!1){b.disabled_plugins[g]=1;continue}if(b.disabled_plugins[g]&&delete b.disabled_plugins[g],"function"==typeof this.plugins[g].init)try{this.plugins[g].init(e)}catch(i){BOOMR.addError(i,this.plugins[g]+".init")}}return b.handlers_attached?this:(b.onloadfired||void 0!==e.autorun&&e.autorun===!1||(d.readyState&&"complete"===d.readyState?this.setImmediate(BOOMR.page_ready,null,null,BOOMR):a.onpagehide||null===a.onpagehide?c.utils.addListener(a,"pageshow",BOOMR.page_ready):c.utils.addListener(a,"load",BOOMR.page_ready)),c.utils.addListener(a,"DOMContentLoaded",function(){b.fireEvent("dom_loaded")}),function(){var e,f,g;for(e=function(){b.fireEvent("visibility_changed")},d.webkitVisibilityState?c.utils.addListener(d,"webkitvisibilitychange",e):d.msVisibilityState?c.utils.addListener(d,"msvisibilitychange",e):d.visibilityState&&c.utils.addListener(d,"visibilitychange",e),c.utils.addListener(d,"mouseup",b.onclick_handler),f=d.getElementsByTagName("form"),g=0;g<f.length;g++)c.utils.addListener(f[g],"submit",b.onsubmit_handler);a.onpagehide||null===a.onpagehide||c.utils.addListener(a,"unload",function(){BOOMR.window=a=null})}(),b.handlers_attached=!0,this)},page_ready:function(c){return c||(c=a.event),c||(c={name:"load"}),b.onloadfired?this:(b.fireEvent("page_ready",c),b.onloadfired=!0,this)},setImmediate:function(b,c,d,e){var f=function(){b.call(e||null,c,d||{}),f=null};a.setImmediate?a.setImmediate(f):a.msSetImmediate?a.msSetImmediate(f):a.webkitSetImmediate?a.webkitSetImmediate(f):a.mozSetImmediate?a.mozSetImmediate(f):setTimeout(f,10)},subscribe:function(d,e,f,g){var h,i,j,k;if(d=d.toLowerCase(),!b.events.hasOwnProperty(d))return this;for(j=b.events[d],h=0;h<j.length;h++)if(i=j[h],i.fn===e&&i.cb_data===f&&i.scope===g)return this;return j.push({fn:e,cb_data:f||{},scope:g||null}),"page_ready"===d&&b.onloadfired&&this.setImmediate(e,null,f,g),"page_unload"===d&&(k=function(b){e&&e.call(g,b||a.event,f)},a.onpagehide||null===a.onpagehide?c.utils.addListener(a,"pagehide",k):c.utils.addListener(a,"unload",k),c.utils.addListener(a,"beforeunload",k)),this},addError:function(a,c){"string"!=typeof a&&(a=String(a)),void 0!==c&&(a="["+c+":"+(new Date).getTime()+"] "+a),b.errors[a]?b.errors[a]++:b.errors[a]=1},addVar:function(a,c){if("string"==typeof a)b.vars[a]=c;else if("object"==typeof a){var e,d=a;for(e in d)d.hasOwnProperty(e)&&(b.vars[e]=d[e])}return this},removeVar:function(a){var c,d;if(!arguments.length)return this;for(d=1===arguments.length&&"[object Array]"===Object.prototype.toString.apply(a)?a:arguments,c=0;c<d.length;c++)b.vars.hasOwnProperty(d[c])&&delete b.vars[d[c]];return this},requestStart:function(a){var b=(new Date).getTime();return BOOMR.plugins.RT.startTimer("xhr_"+a,b),{loaded:function(c){BOOMR.responseEnd(a,b,c)}}},responseEnd:function(a,c,d){BOOMR.plugins.RT.startTimer("xhr_"+a,c),b.fireEvent("xhr_load",{name:"xhr_"+a,data:d})},sendBeacon:function(){var c,e,f,g,h,i=[];BOOMR.debug("Checking if we can send beacon");for(c in this.plugins)if(this.plugins.hasOwnProperty(c)){if(b.disabled_plugins[c])continue;if(!this.plugins[c].is_complete())return BOOMR.debug("Plugin "+c+" is not complete, deferring beacon send"),!1}b.vars.v=BOOMR.version,b.vars.u=BOOMR.utils.cleanupURL(d.URL.replace(/#.*/,"")),a!==window&&(b.vars["if"]="");for(c in b.errors)b.errors.hasOwnProperty(c)&&i.push(c+(b.errors[c]>1?" (*"+b.errors[c]+")":""));return i.length>0&&(b.vars.errors=i.join("\n")),b.errors={},b.fireEvent("before_beacon",b.vars),b.beacon_url?(e=[],h=BOOMR.utils.pushVars(e,b.vars),this.setImmediate(b.fireEvent,"onbeacon",b.vars,b),h?(e=e.join("&"),"POST"===b.beacon_type?BOOMR.utils.postData(e):(f=b.beacon_url+(b.beacon_url.indexOf("?")>-1?"&":"?")+e,f.length>2e3&&"AUTO"===b.beacon_type?BOOMR.utils.postData(e):(BOOMR.debug("Sending url: "+f.replace(/&/g,"\n	")),g=new Image,g.src=f)),!0):this):(BOOMR.debug("No beacon_url, but would have sent: "+BOOMR.utils.objectToString(b.vars)),!0)}},delete BOOMR_start,"number"==typeof BOOMR_lstart?(c.t_lstart=BOOMR_lstart,delete BOOMR_lstart):"number"==typeof BOOMR.window.BOOMR_lstart&&(c.t_lstart=BOOMR.window.BOOMR_lstart),function(){var b;a.YAHOO&&a.YAHOO.widget&&a.YAHOO.widget.Logger?c.log=a.YAHOO.log:a.Y&&a.Y.log?c.log=a.Y.log:"object"==typeof console&&void 0!==console.log&&(c.log=function(a,b,c){console.log(c+": ["+b+"] "+a)}),b=function(a){return function(b,c){return this.log(b,a,"boomerang"+(c?"."+c:"")),this}},c.debug=b("debug"),c.info=b("info"),c.warn=b("warn"),c.error=b("error")}(),function(){var a;for(a in c)c.hasOwnProperty(a)&&(BOOMR[a]=c[a])}(),BOOMR.plugins=BOOMR.plugins||{},g("onBoomerangLoaded",{BOOMR:BOOMR}))}(window),function(){BOOMR=BOOMR||{},BOOMR.plugins=BOOMR.plugins||{};var a={complete:!1,done:function(){var b,c,d,e,a=BOOMR.window;if(this.complete)return this;if(b=a.performance||a.msPerformance||a.webkitPerformance||a.mozPerformance,b&&b.timing&&b.navigation){BOOMR.info("This user agent supports NavigationTiming.","nt"),c=b.navigation,d=b.timing;var f=d.navigationStart;navigator.userAgent.match(/Firefox\/[78]\./)&&(f=d.unloadEventStart||d.fetchStart||void 0),e={timeToFirstByte:d.responseStart-f,domProcessing:d.domContentLoadedEventEnd-d.responseStart,pageRendering:d.loadEventStart-d.domContentLoadedEventEnd,totalPageLoadTime:d.loadEventStart-f},BOOMR.addVar(e)}this.complete=!0,BOOMR.sendBeacon()}};BOOMR.plugins.javamelody={init:function(){return BOOMR.subscribe("page_ready",a.done,null,a),BOOMR.subscribe("page_unload",a.done,null,a),this},is_complete:function(){return a.complete}}}(),BOOMR.t_end=(new Date).getTime();
var boomrScript = document.getElementById("boomr");
BOOMR.init({beacon_url: boomrScript.getAttribute("data-beacon-url"), log: null});
BOOMR.addVar('requestName', boomrScript.getAttribute("data-request-name"));
BOOMR.addVar('serverTime', boomrScript.getAttribute("data-server-time"));
